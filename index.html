<!DOCTYPE html>
<html>

<head>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://unpkg.com/split.js/dist/split.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="./blocks/string_length.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="content">
        <div class="pane left">
            <div class="pane leftTop">
                <a-scene class="pane" embedded physics="debug:false;" cursor="rayOrigin: mouse">
                    <a-sky color="#964"></a-sky>
                    <a-camera></a-camera>
                    <a-entity oculus-touch-controls="hand: left"></a-entity>
                    <a-entity oculus-touch-controls="hand: right"></a-entity>
                    <a-box  id="boxToClick" position="0 1 -3" color="red" dynamic-body></a-box>
                    <a-plane color="#159" rotation="-90 0 0" scale="1000 1000 1" static-body></a-plane>
                    <!-- <a-gltf-model src="aframeDemoScene.gltf" rotation="-90 0 0" scale="1 1 1"></a-gltf-model> -->
                    <a-light position="-3 2 1" type="point"></a-light>
                </a-scene>
            </div>
            <div class="pane leftBot">
                <p>Some tool stuff will go here</p>
            </div>
        </div>
        <div class="pane right" id="blocklyArea">
            <div id="blocklyDiv" style="height: 100%"></div>
        </div>
    </div>
</body>

<!-- Blockly Toolbox -->
<xml id="toolbox" style="display: none">
    <block type='string_length'></block>
</xml>

<script>
    let blocklyArea = document.querySelector('#blocklyArea');
    let blocklyDiv = document.querySelector('#blocklyDiv');
    let workspace = Blockly.inject('blocklyDiv', {toolbox: document.querySelector('#toolbox')});
    let blocklyResize = function(){ 
        let element = blocklyArea; 
        // let x = 0; 
        // let y = 0;
        // do {
        //     x += element.offsetLeft; 
        //     y += element.offsetTop; 
        //     element = element.offsetParent;
        // }while (element);
        // blocklyDiv.style.left = `${x}px`;
        // blocklyDiv.style.top = `${y}px`;
        // blocklyDiv.style.width = `${blocklyArea.offsetWidth}px`;
        // blocklyDiv.style.height = `${blocklyArea.offSetHeight}px`;
        Blockly.svgResize(workspace);
    }

    let aCanvas = document.querySelector('a-scene canvas');
    let aScene = document.querySelector('a-scene');
    let boxCounter = 1;
    let boxSpawner = setInterval( ()=>{
        let tmpBox = document.createElement('a-box');
        tmpBox.setAttribute('position',`${Math.random()} ${100*Math.random()} -10`);
        if(boxCounter%100 == 0){
            //tmpBox.setAttribute('scale','4 4 4');
            clearInterval(boxSpawner);
        }
        tmpBox.setAttribute('dynamic-body','');
        aScene.appendChild(tmpBox);
        boxCounter++;
    }, 100 )

    function boxMove(e){
        let pos = e.target.getAttribute('position');
        e.target.setAttribute('position', `${pos['x']} ${pos['y']} ${pos['z']-.1}` );
    }


    Split(['.left','.right'],{
        direction: 'horizontal',
        onDrag: function(){
            aScene.camera.aspect = aScene.clientWidth/aScene.clientHeight;
            aScene.camera.updateProjectionMatrix();
            aScene.renderer.setSize(aScene.clientWidth,aScene.clientHeight);
            aScene.components.cursor.updateCanvasBounds();
            blocklyResize();
        }
    });

    let leftPanes = Split(['.leftTop','.leftBot'],{
        direction: 'vertical',
        onDrag: function(){
            aScene.camera.aspect = aScene.clientWidth/aScene.clientHeight;
            aScene.camera.updateProjectionMatrix();
            aScene.renderer.setSize(aScene.clientWidth,aScene.clientHeight);
            aScene.components.cursor.updateCanvasBounds();
        },
    });

    window.addEventListener('resize',function(){
            aScene.camera.aspect = aScene.clientWidth/aScene.clientHeight;
            aScene.camera.updateProjectionMatrix();
            aScene.renderer.setSize(aScene.clientWidth,aScene.clientHeight);
            aScene.components.cursor.updateCanvasBounds();
            blocklyResize();
    });

    // document.querySelector('#boxToClick').addEventListener('mouseenter',boxMove)

</script>

</html>